==生产一个代理对象，之前需要做的几件事情![image-20230514215943303](D:\音乐图片\typora图片\image-20230514215943303.png)



```java
MockClusterInvoker的属性   下面
{
    // 是一个接口具体对应变量的实现类 是哪个实现类，根据实际情况，由于接口有多个实现类
    private final Invoker<T> invoker;


}
public class FailoverClusterInvoker<T> extends AbstractClusterInvoker<T> {
    就是下图
}

```



![image-20230516214059124](D:\音乐图片\typora图片\image-20230516214059124.png)





![image-20230516215208968](D:\音乐图片\typora图片\image-20230516215208968.png)





引入服务时间是在启动spring容器（消费者服务器） （解析Refrence注解）就会引入服务，在引入服务时候就会到远程注册中心去查询 提供的服务接口



服务目录-- 引入3服务，每个服务目录有多少个提供者，3个服务 3个list<Invoker>  List<DubboInvoker>



由于远程注册中心上面使用redis缓存的是URL类型的一个字符串（是服务提供者每一个Servicebean的另外一种表达形式），

消费者其实从远程下载(拉取的也是一个个URL对象)，需要将一个URL解析 翻译成 List<DubboInvoker>   集合，

此外由于服务提供者有个在新增接口（ServiceBean） ，注册中心的URL 可能随时更新，所以需要 监听 注册中心Zookeeker 上面 URL的变化， 如果有变化 ，则更新消费者这边的 本地缓存 也就是redis里面的Map.

此外，本地缓存抓取的List<>  例如有100个实例接口，我在某一次请求的时候，只是发送了一个接口实例， 那么在服务消费端还需要，从100个实例中找到 唯一的这个 服务实例， 也就 叫 路由，

```
RegistryDirectory 就是服务目录
```

![引入服务的流程下面](D:\音乐图片\typora图片\image-20230516221605615.png)





我们知道从服务端把每个Servicebean注册到远程注册中心时候，每个Servicebean对应的URL 字符的拼接会包括@Service注解配置的超时timeOut,version等规则

由于引入一个服务时候  也会在消费端使用注解@Reference()  注解 也是可以配置一些规则，例如超时等等；



 [(9条消息) Dubbo配置的优先级_Dongguabai的博客-CSDN博客](https://blog.csdn.net/Dongguabai/article/details/84335717#:~:text=全局 配置优先级 dubbo 支持JVM参数、xml文件和properties文件来指定其 配置 。 其 优先级,会重写 dubbo .properties中的； Properties，默认 配置 ，仅仅作用于以上两者没有 配置 时。)



举例负载均衡如果在服务端和消费端   分别使用注解@Service(loadBance=Random)  @Reference(loadBance="轮询")    那么实际情况会使用哪边的呢

 



![配置优先级](D:\音乐图片\typora图片\image-20230517202801260.png)





配置优先级（-D  System.getProperty(),@Service  三种）  duboo-admin后台配置中心，优先级最高动态





```
@SPI(FailoverCluster.NAME)
public interface Cluster {

spi扩展机制
```

---



消费端路由； 标签路由，条件路由，







[第六节: Dubbo服务引入源码解析 (yuque.com)](https://www.yuque.com/renyong-jmovm/rfwlqe/dm83cc#8Drwg)

密码kkys